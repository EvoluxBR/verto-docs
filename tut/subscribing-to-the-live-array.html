<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>Verto Docs - Subscribing to the live array</title>
        <meta name="description" content="Verto Documentation">

        <link rel="stylesheet" href="/verto-docs/css/bootstrap.min.css">
        <link rel="stylesheet" href="/verto-docs/css/syntax.css">
        <link rel="stylesheet" href="/verto-docs/css/main.css">
    </head>
    <body>
      
        <a href="https://github.com/EvoluxBR/verto-docs">
          <img src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67"
               class="github-ribbon" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"/>
        </a>

        <div class="container">
            <div class="row">
                <div class="header-container affix">
                    <div id="header" class="container">
                        <h4>
  <a class="brand" href="/verto-docs/">Verto Docs</a>
  <small>Verto Documentation</small>
</h4>

                    </div>
                </div>
            </div>

            <div class="row">
                
                
                    <div id="navigation" class="col-sm-3">
                        <ul class="nav nav-list">
    <li><a href="/verto-docs/">Home</a></li>
    
        
        
	
  	
        
    
        
        
	
  	
        
            
                <li class="nav-header">Tutorial</li>
            
            <li data-order="1">
                
                <a href="/verto-docs/tut/getting-started.html">
                    Getting Started
                </a>
                
            </li>
        
            
            <li data-order="2">
                
                <a href="/verto-docs/tut/installing-verto.html">
                    Installing Verto
                </a>
                
            </li>
        
            
            <li data-order="3">
                
                <a href="/verto-docs/tut/initializing-verto.html">
                    Initializing Verto
                </a>
                
            </li>
        
            
            <li data-order="4">
                
                <a href="/verto-docs/tut/making-a-call.html">
                    Making a Call
                </a>
                
            </li>
        
            
            <li data-order="5">
                
                <a href="/verto-docs/tut/hanging-up-a-call.html">
                    Hanging Up a Call
                </a>
                
            </li>
        
            
            <li data-order="6">
                
                <a href="/verto-docs/tut/answering-a-call.html">
                    Answering a Call
                </a>
                
            </li>
        
            
            <li data-order="7">
                
                <a href="/verto-docs/tut/adding-video-support.html">
                    Adding Video Support
                </a>
                
            </li>
        
            
            <li data-order="8">
                
                <a href="/verto-docs/tut/recovering-a-call.html">
                    Recovering a Call
                </a>
                
            </li>
        
            
            <li data-order="9">
                
                <a href="/verto-docs/tut/muting-a-call.html">
                    Muting a Call
                </a>
                
            </li>
        
            
            <li data-order="10">
                
                <a href="/verto-docs/tut/holding-a-call.html">
                    Holding a Call
                </a>
                
            </li>
        
            
            <li data-order="11">
                
                <a href="/verto-docs/tut/transferring-a-call.html">
                    Transferring a Call
                </a>
                
            </li>
        
            
            <li data-order="12">
                
                <a href="/verto-docs/tut/subscribing-to-the-live-array.html" class="active">
                    Subscribing to the live array
                </a>
                
            </li>
        
            
            <li data-order="13">
                
                <a href="/verto-docs/tut/sending-conference-commands.html">
                    Sending conference commands
                </a>
                
            </li>
        
            
            <li data-order="14">
                
                <a href="/verto-docs/tut/sending-dtmf.html">
                    Sending DTMF
                </a>
                
            </li>
        
            
            <li data-order="15">
                
                <a href="/verto-docs/tut/sending-chat-messages.html">
                    Sending chat messages
                </a>
                
            </li>
        
            
            <li data-order="16">
                
                <a href="/verto-docs/tut/testing-bandwidth.html">
                    Testing bandwidth
                </a>
                
            </li>
        
            
            <li data-order="17">
                
                <a href="/verto-docs/tut/adding-h264-support.html">
                    Adding H264 Support
                </a>
                
            </li>
        
    
        
        
	
  	
        
    
        
        
	
  	
        
            
                <li class="nav-header">Developers</li>
            
            <li data-order="1">
                
                <a href="/verto-docs/dev/contributors.html">
                    Contributors
                </a>
                
            </li>
        
    
    <!-- List additional links. It is recommended to add a divider
         e.g. <li class="divider"></li> first to break up the content. -->
</ul>

                    </div>

                    <div id="content" class="col-sm-9">
                        <div class="page-header">
    <h2>Subscribing to the live array
        
    </h2>
</div>

<p>The live array enables you to receive real time server data in a javascript array.</p>

<p>All users dialed into a conference are added to the live array data on the server,
and Verto clients can choose to subscribe to the live array to receive conference
events. FreeSWITCH handles sending the events to all subscribers. Typical events
include:</p>

<ul>
<li>User join/leave</li>
<li>Video/audio mute/unmute</li>
<li>Talking</li>
<li>Video floor</li>
</ul>

<p>Support also exists for receiving chat data from the server.</p>

<h2 id="preparing-to-subscribe">Preparing to subscribe</h2>

<p>A caller must be joined to the live array in order to subscribe to live array
updates.</p>

<p>The <code>onMessage</code> callback receives general broadcast messages from the
server, including events for when a caller has joined and left the live array.</p>

<p>So, the first step is to add an <code>onMessage</code> callback to our callbacks object:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Receives conference-related messages from FreeSWITCH.</span>
<span class="c1">// Note that it&#39;s possible to write server-side modules to send customized</span>
<span class="c1">// messages via this callback.</span>
<span class="kd">function</span> <span class="nx">onMessage</span><span class="p">(</span><span class="nx">verto</span><span class="p">,</span> <span class="nx">dialog</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">$</span><span class="p">.</span><span class="nx">verto</span><span class="p">.</span><span class="kr">enum</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">pvtEvent</span><span class="o">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">pvtData</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">pvtData</span><span class="p">.</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// This client has joined the live array for the conference.</span>
          <span class="k">case</span> <span class="s2">&quot;conference-liveArray-join&quot;</span><span class="o">:</span>
            <span class="c1">// With the initial live array data from the server, you can</span>
            <span class="c1">// configure/subscribe to the live array.</span>
            <span class="nx">initLiveArray</span><span class="p">(</span><span class="nx">verto</span><span class="p">,</span> <span class="nx">dialog</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="c1">// This client has left the live array for the conference.</span>
          <span class="k">case</span> <span class="s2">&quot;conference-liveArray-part&quot;</span><span class="o">:</span>
            <span class="c1">// Some kind of client-side wrapup...</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="c1">// TODO: Needs doc.</span>
    <span class="k">case</span> <span class="nx">$</span><span class="p">.</span><span class="nx">verto</span><span class="p">.</span><span class="kr">enum</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">info</span><span class="o">:</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="c1">// TODO: Needs doc.</span>
    <span class="k">case</span> <span class="nx">$</span><span class="p">.</span><span class="nx">verto</span><span class="p">.</span><span class="kr">enum</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">display</span><span class="o">:</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">$</span><span class="p">.</span><span class="nx">verto</span><span class="p">.</span><span class="kr">enum</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">clientReady</span><span class="o">:</span>
      <span class="c1">// 1.8.x+</span>
      <span class="c1">// Fired when the server has finished re-attaching any active sessions.</span>
      <span class="c1">// data.reattached_sessions contains an array of session IDs for all</span>
      <span class="c1">// sessions that were re-attached.</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">vertoCallbacks</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">onMessage</span><span class="o">:</span> <span class="nx">onMessage</span><span class="p">,</span>
  <span class="c1">// Other callbacks...</span>
<span class="p">};</span>
</code></pre></div>
<h2 id="subscribing">Subscribing</h2>

<p>Once the client has joined the live array and received the data from the server,
they can subscribe to events.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/*</span>
<span class="cm"> * Setting up and subscribing to the live array.</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">vertoConf</span><span class="p">,</span> <span class="nx">liveArray</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">initLiveArray</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">verto</span><span class="p">,</span> <span class="nx">dialog</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Set up addtional configuration specific to the call.</span>
    <span class="nx">vertoConf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">verto</span><span class="p">.</span><span class="nx">conf</span><span class="p">(</span><span class="nx">verto</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">dialog</span><span class="o">:</span> <span class="nx">dialog</span><span class="p">,</span>
      <span class="nx">hasVid</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">laData</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">pvtData</span><span class="p">,</span>
      <span class="c1">// For subscribing to published chat messages.</span>
      <span class="nx">chatCallback</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">verto</span><span class="p">,</span> <span class="nx">eventObj</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">eventObj</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">fromDisplay</span> <span class="o">||</span> <span class="nx">eventObj</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">from</span> <span class="o">||</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">eventObj</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="p">},</span>
    <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">subParams</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">callID</span><span class="o">:</span> <span class="nx">dialog</span> <span class="o">?</span> <span class="nx">dialog</span><span class="p">.</span><span class="nx">callID</span> <span class="o">:</span> <span class="kc">null</span>
      <span class="p">},</span>
    <span class="p">};</span>
    <span class="c1">// Set up the live array, using the live array data received from FreeSWITCH.</span>
    <span class="nx">liveArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">verto</span><span class="p">.</span><span class="nx">liveArray</span><span class="p">(</span><span class="nx">vertoObj</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">pvtData</span><span class="p">.</span><span class="nx">laChannel</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">pvtData</span><span class="p">.</span><span class="nx">laName</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
    <span class="c1">// Subscribe to live array changes.</span>
    <span class="nx">liveArray</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">liveArrayObj</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Call UUID is: &quot;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Call data is: &quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>

          <span class="c1">// Initial list of existing conference users.</span>
          <span class="k">case</span> <span class="s2">&quot;bootObj&quot;</span><span class="o">:</span>
            <span class="k">break</span><span class="p">;</span>

          <span class="c1">// New user joined conference.</span>
          <span class="k">case</span> <span class="s2">&quot;add&quot;</span><span class="o">:</span>
            <span class="k">break</span><span class="p">;</span>

          <span class="c1">// User left conference.</span>
          <span class="k">case</span> <span class="s2">&quot;del&quot;</span><span class="o">:</span>
            <span class="k">break</span><span class="p">;</span>

          <span class="c1">// Existing user&#39;s state changed (mute/unmute, talking, floor, etc)</span>
          <span class="k">case</span> <span class="s2">&quot;modify&quot;</span><span class="o">:</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="p">}</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;ERROR: &quot;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="c1">// Called if the live array throws an error.</span>
    <span class="nx">liveArray</span><span class="p">.</span><span class="nx">onErr</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="live-array-data-format">Live array data format</h2>

<p>There is currently no documentation for the live array data format, however
it&#39;s quite easy to discover it by exercising a javascript debugger on your
implementation of the code above, and inspecting <code>args.key</code> and <code>args.data</code>.</p>


                    </div>
                
            </div>

            
            <div class="row">
              
                <div id="navigation" class="col-sm-2"></div>
                <div id="disqus" class="col-sm-10">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'vertodocs'; // required: replace example with your forum shortname
    var disqus_identifier = '2016-08-10-subscribing-to-the-live-array';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                </div>
              
            </div>
            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="">Verto Docs</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40516497-3', 'auto');
  ga('send', 'pageview');
</script>

        
    </body>
</html>
